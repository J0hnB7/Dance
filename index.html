<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DanceComp</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged }
  from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
import { getFirestore, collection, doc, addDoc, setDoc, getDoc, getDocs,
  updateDoc, onSnapshot, query, where, orderBy, runTransaction, serverTimestamp, increment }
  from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  âš™ï¸  KONFIGURACE FIREBASE
//  ZÃ­skejte na: https://console.firebase.google.com
//  â†’ VÃ¡Å¡ projekt â†’ NastavenÃ­ â†’ PÅ™idat webovou aplikaci
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey:            "AIzaSyCU44y8TKQfUIqptidYe-jd5qaxFIY-iDE",
  authDomain:        "dance-c710a.firebaseapp.com",
  projectId:         "dance-c710a",
  storageBucket:     "dance-c710a.firebasestorage.app",
  messagingSenderId: "137065448718",
  appId:             "1:137065448718:web:ce44dd7ca05f983da0435f",
  measurementId:     "G-3LZMQBLPGB"
};
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const app  = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

// â”€â”€â”€ GLOBAL STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentUser    = null;
let currentRole    = null; // 'admin' | 'jury' | null
let currentJurorId = null;
let realtimeUnsubs = [];
let pendingPage    = null;

window._app = { auth, db, collection, doc, addDoc, setDoc, getDoc, getDocs,
  updateDoc, onSnapshot, query, where, orderBy, runTransaction, serverTimestamp,
  increment, signInWithEmailAndPassword, signOut };

// â”€â”€â”€ AUTH OBSERVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
onAuthStateChanged(auth, async (user) => {
  if (user) {
    currentUser = user;
    // ZjistÃ­me roli z Firestore kolekce `users`
    const snap = await getDoc(doc(db, 'users', user.uid));
    if (snap.exists()) {
      const data = snap.data();
      currentRole    = data.role;   // 'admin' nebo 'jury'
      currentJurorId = user.uid;
    }
    updateAuthUI();
  } else {
    currentUser    = null;
    currentRole    = null;
    currentJurorId = null;
    updateAuthUI();
  }
});

function updateAuthUI() {
  const loggedIn = !!currentUser;
  document.getElementById('navLogin').style.display  = loggedIn ? 'none'  : 'flex';
  document.getElementById('navLogout').style.display = loggedIn ? 'flex'  : 'none';
  document.getElementById('navJury').style.display   = (loggedIn && (currentRole==='jury'||currentRole==='admin')) ? 'flex' : 'none';
  document.getElementById('navAdmin').style.display  = (loggedIn && currentRole==='admin') ? 'flex' : 'none';
  document.getElementById('userLabel').textContent   = currentUser?.email || '';
  // Aktualizujeme aktuÃ¡lnÃ­ view pokud je relevantnÃ­
  if (currentPage === 'jury' || currentPage === 'admin') showPage(currentPage);
}

// â”€â”€â”€ ROUTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentPage = 'home';

window.showPage = function(page) {
  currentPage = page;
  realtimeUnsubs.forEach(u => u());
  realtimeUnsubs = [];

  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

  document.getElementById('page-' + page)?.classList.add('active');
  document.getElementById('nav-'  + page)?.classList.add('active');

  const loaders = { home: loadHome, register: loadRegister, jury: loadJury, admin: loadAdmin };
  loaders[page]?.();
  window.scrollTo(0, 0);
}

// â”€â”€â”€ HOME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadHome() {
  const el = document.getElementById('homeComps');
  el.innerHTML = '<p class="loading-text">NaÄÃ­tÃ¡m soutÄ›Å¾eâ€¦</p>';
  try {
    const snap = await getDocs(query(collection(db,'competitions'), where('status','==','open'), orderBy('date')));
    if (snap.empty) { el.innerHTML = '<p class="empty-txt">Å½Ã¡dnÃ© otevÅ™enÃ© soutÄ›Å¾e.</p>'; return; }
    el.innerHTML = snap.docs.map(d => {
      const c = d.data();
      return `<div class="comp-pill" onclick="prefillComp('${d.id}'); showPage('register')">
        <div>
          <div class="comp-pill-name">${esc(c.name)}</div>
          <div class="comp-pill-date">${fmtDate(c.date)}</div>
        </div>
        <span class="badge badge-open">Registrace â†’</span>
      </div>`;
    }).join('');
  } catch(e) { el.innerHTML = `<p class="err-txt">Chyba: ${e.message}</p>`; }
}

window.prefillComp = function(id) {
  document.getElementById('regCompSel').value = id;
}

// â”€â”€â”€ REGISTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadRegister() {
  const sel = document.getElementById('regCompSel');
  sel.innerHTML = '<option value="">NaÄÃ­tÃ¡mâ€¦</option>';
  try {
    const snap = await getDocs(query(collection(db,'competitions'), where('status','==','open'), orderBy('date')));
    if (snap.empty) { sel.innerHTML = '<option value="">Å½Ã¡dnÃ© otevÅ™enÃ© soutÄ›Å¾e</option>'; return; }
    sel.innerHTML = '<option value="">â€” Vyberte soutÄ›Å¾ â€”</option>' +
      snap.docs.map(d => `<option value="${d.id}">${esc(d.data().name)} (${fmtDate(d.data().date)})</option>`).join('');
  } catch(e) { sel.innerHTML = `<option value="">Chyba: ${e.message}</option>`; }
}

window.doRegister = async function() {
  const compId = document.getElementById('regCompSel').value;
  const name   = document.getElementById('regName').value.trim();
  const email  = document.getElementById('regEmail').value.trim().toLowerCase();

  clearMsg('regMsg');
  if (!compId) return showMsg('regMsg','error','Vyberte prosÃ­m soutÄ›Å¾.');
  if (!name)   return showMsg('regMsg','error','Zadejte celÃ© jmÃ©no.');
  if (!email || !email.includes('@')) return showMsg('regMsg','error','Zadejte platnÃ½ e-mail.');

  setBtnLoading('regBtn', true, 'Registrujiâ€¦');

  try {
    // AtomickÃ¡ registrace â€“ transakce zajistÃ­ unikÃ¡tnÃ­ ÄÃ­slo
    const compRef   = doc(db, 'competitions', compId);
    const counterRef = doc(db, 'counters', compId);

    let newNumber, participantId;

    await runTransaction(db, async (tx) => {
      const comp    = await tx.get(compRef);
      const counter = await tx.get(counterRef);

      if (!comp.exists()) throw new Error('SoutÄ›Å¾ neexistuje.');
      if (comp.data().status !== 'open') throw new Error('Registrace je uzavÅ™ena.');

      // Zkontrolujeme duplicitnÃ­ email v tÃ©to soutÄ›Å¾i
      const dupSnap = await getDocs(query(
        collection(db,'participants'),
        where('competitionId','==',compId),
        where('email','==',email)
      ));
      if (!dupSnap.empty) throw new Error('Tento e-mail je jiÅ¾ registrovÃ¡n v tÃ©to soutÄ›Å¾i.');

      newNumber = (counter.exists() ? counter.data().lastNumber : 0) + 1;
      tx.set(counterRef, { lastNumber: newNumber }, { merge: true });

      const pRef = doc(collection(db,'participants'));
      participantId = pRef.id;
      tx.set(pRef, {
        competitionId: compId,
        name, email,
        number: newNumber,
        registeredAt: serverTimestamp()
      });
    });

    setBtnLoading('regBtn', false);
    // Zobrazit ÃºspÄ›ch
    document.getElementById('regForm').style.display    = 'none';
    document.getElementById('regSuccess').style.display = 'flex';
    document.getElementById('regSuccessNum').textContent  = newNumber;
    document.getElementById('regSuccessName').textContent = name;

  } catch(e) {
    setBtnLoading('regBtn', false);
    showMsg('regMsg','error', e.message);
  }
}

window.regReset = function() {
  document.getElementById('regForm').style.display    = 'block';
  document.getElementById('regSuccess').style.display = 'none';
  document.getElementById('regName').value  = '';
  document.getElementById('regEmail').value = '';
  clearMsg('regMsg');
}

// â”€â”€â”€ JURY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadJury() {
  const wrap = document.getElementById('juryWrap');

  if (!currentUser || (currentRole !== 'jury' && currentRole !== 'admin')) {
    wrap.innerHTML = loginPrompt('jury');
    return;
  }

  wrap.innerHTML = `
    <div class="section-header">
      <div>
        <div class="eyebrow">HodnocenÃ­</div>
        <h2 class="section-title">Porota</h2>
        <p class="section-sub">HodnotÃ­te jako: <span style="color:var(--gold)">${currentUser.email}</span></p>
      </div>
    </div>
    <div class="field">
      <label>Vyberte aktivnÃ­ kolo</label>
      <select id="juryRoundSel" onchange="loadJuryRound()" class="select-input">
        <option value="">NaÄÃ­tÃ¡m kolaâ€¦</option>
      </select>
    </div>
    <div id="juryScoringArea"></div>`;

  // NaÄteme aktivnÃ­ kola
  try {
    const snap = await getDocs(query(collection(db,'rounds'), where('status','in',['active','closed']), orderBy('createdAt','desc')));
    const sel = document.getElementById('juryRoundSel');
    if (snap.empty) { sel.innerHTML = '<option value="">Å½Ã¡dnÃ¡ aktivnÃ­ kola</option>'; return; }
    sel.innerHTML = '<option value="">â€” Vyberte kolo â€”</option>' +
      snap.docs.map(d => {
        const r = d.data();
        const icon = r.status === 'active' ? 'ğŸŸ¢ ' : 'ğŸ”´ ';
        return `<option value="${d.id}" data-status="${r.status}">${icon}${esc(r.name)}</option>`;
      }).join('');
  } catch(e) { document.getElementById('juryScoringArea').innerHTML = `<p class="err-txt">${e.message}</p>`; }
}

window.loadJuryRound = async function() {
  const sel      = document.getElementById('juryRoundSel');
  const roundId  = sel.value;
  const isActive = sel.options[sel.selectedIndex]?.dataset.status === 'active';
  const area     = document.getElementById('juryScoringArea');
  realtimeUnsubs.forEach(u=>u()); realtimeUnsubs=[];

  if (!roundId) { area.innerHTML=''; return; }

  area.innerHTML = '<p class="loading-text">NaÄÃ­tÃ¡m ÃºÄastnÃ­kyâ€¦</p>';

  try {
    const roundSnap = await getDoc(doc(db,'rounds', roundId));
    const round     = roundSnap.data();

    const partSnap  = await getDocs(query(
      collection(db,'participants'),
      where('competitionId','==',round.competitionId),
      orderBy('number')
    ));
    const participants = partSnap.docs.map(d=>({id:d.id,...d.data()}));

    // NaÄteme moje hodnocenÃ­
    const myScoresSnap = await getDocs(query(
      collection(db,'scores'),
      where('roundId','==',roundId),
      where('jurorId','==',currentJurorId)
    ));
    const myScores = {};
    myScoresSnap.docs.forEach(d => { myScores[d.data().participantId] = d.data().score; });

    // PoÄty hodnocenÃ­ od vÅ¡ech porotcÅ¯ (realtime)
    const allScoresRef = query(collection(db,'scores'), where('roundId','==',roundId));

    const renderTable = (juryCounts) => {
      const saved = Object.keys(myScores).length;
      const total = participants.length;
      const pct   = total ? Math.round(saved/total*100) : 0;

      let html = `
        ${!isActive ? `<div class="notice-locked">ğŸ”’ Toto kolo je uzavÅ™eno. Body nelze mÄ›nit.</div>` : ''}
        <div class="progress-card">
          <div class="progress-top">
            <span class="progress-label">VaÅ¡e hodnocenÃ­</span>
            <span class="progress-val">${saved} / ${total}</span>
          </div>
          <div class="progress-track"><div class="progress-fill" style="width:${pct}%"></div></div>
        </div>
        <div class="table-card">
          <table>
            <thead><tr>
              <th style="width:60px">ÄŒÃ­slo</th>
              <th>JmÃ©no</th>
              <th style="text-align:center;width:90px">Porotci</th>
              <th style="width:110px">Body</th>
              <th style="width:110px;text-align:center">Akce</th>
            </tr></thead>
            <tbody>`;

      participants.forEach(p => {
        const sc      = myScores[p.id];
        const isSaved = sc !== undefined;
        const cnt     = juryCounts[p.id] || 0;
        const dots    = Array.from({length:Math.max(cnt,3)},(_,i)=>
          `<span class="dot${i<cnt?' dot-filled':''}"></span>`).join('');

        html += `<tr id="jrow-${p.id}" class="${isSaved?'row-saved':''}">
          <td><div class="num-circle">${p.number}</div></td>
          <td class="td-name">${esc(p.name)}</td>
          <td><div class="dots-row">${dots}</div></td>
          <td>
            <input type="number" id="jinput-${p.id}" min="0" max="100" step="0.5"
              value="${isSaved?sc:''}" placeholder="0â€“100"
              class="score-input${isSaved?' input-saved':''}"
              ${!isActive?'disabled':''}
              onkeydown="if(event.key==='Enter') saveJuryScore('${roundId}','${p.id}')"
              oninput="onJuryInput('${p.id}')">
          </td>
          <td style="text-align:center">
            <button id="jbtn-${p.id}"
              class="btn-save${isSaved?' btn-saved':''}"
              onclick="saveJuryScore('${roundId}','${p.id}')"
              ${!isActive?'disabled':''}>
              ${isSaved?'âœ“ UloÅ¾eno':'UloÅ¾it'}
            </button>
          </td>
        </tr>`;
      });

      html += `</tbody></table></div>`;
      if (isActive) html += `<div class="save-all-wrap"><button class="btn-primary" onclick="saveAllScores('${roundId}')">UloÅ¾it vÅ¡e najednou</button></div>`;

      area.innerHTML = html;
    };

    // Realtime listener na counts
    const unsub = onSnapshot(allScoresRef, (snap) => {
      const counts = {};
      snap.docs.forEach(d => {
        const pid = d.data().participantId;
        counts[pid] = (counts[pid]||0)+1;
      });
      // Aktualizujeme jen dots, ne celou tabulku
      participants.forEach(p => {
        const cnt  = counts[p.id]||0;
        const dots = document.getElementById('jrow-'+p.id)?.querySelector('.dots-row');
        if (dots) dots.innerHTML = Array.from({length:Math.max(cnt,3)},(_,i)=>
          `<span class="dot${i<cnt?' dot-filled':''}"></span>`).join('');
      });
    });
    realtimeUnsubs.push(unsub);

    // Initial render
    const initSnap = await getDocs(allScoresRef);
    const initCounts = {};
    initSnap.docs.forEach(d => { const pid=d.data().participantId; initCounts[pid]=(initCounts[pid]||0)+1; });
    renderTable(initCounts);

  } catch(e) { area.innerHTML=`<p class="err-txt">Chyba: ${e.message}</p>`; }
}

window.onJuryInput = function(pid) {
  document.getElementById('jinput-'+pid)?.classList.remove('input-saved','input-error');
  const btn = document.getElementById('jbtn-'+pid);
  if (btn) { btn.classList.remove('btn-saved'); btn.textContent='UloÅ¾it'; }
}

window.saveJuryScore = async function(roundId, participantId) {
  const inp = document.getElementById('jinput-'+participantId);
  const btn = document.getElementById('jbtn-'+participantId);
  const val = parseFloat(inp.value);

  if (isNaN(val)||val<0||val>100) { inp.classList.add('input-error'); return; }

  btn.disabled=true; btn.innerHTML='<span class="spinner"></span>';
  inp.classList.remove('input-error');

  try {
    const scoreId = `${roundId}_${participantId}_${currentJurorId}`;
    await setDoc(doc(db,'scores',scoreId), {
      roundId, participantId,
      jurorId: currentJurorId,
      jurorEmail: currentUser.email,
      score: val,
      savedAt: serverTimestamp()
    });

    inp.classList.add('input-saved');
    btn.classList.add('btn-saved'); btn.textContent='âœ“ UloÅ¾eno'; btn.disabled=false;
    document.getElementById('jrow-'+participantId)?.classList.add('row-saved');
  } catch(e) {
    btn.disabled=false; btn.textContent='âœ— Chyba';
    alert('Chyba uloÅ¾enÃ­: '+e.message);
  }
}

window.saveAllScores = async function(roundId) {
  const inputs = document.querySelectorAll('[id^="jinput-"]');
  for (const inp of inputs) {
    const pid = inp.id.replace('jinput-','');
    if (inp.value && !inp.disabled) await saveJuryScore(roundId, pid);
  }
}

// â”€â”€â”€ ADMIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAdmin() {
  const wrap = document.getElementById('adminWrap');

  if (!currentUser || currentRole !== 'admin') {
    wrap.innerHTML = loginPrompt('admin');
    return;
  }

  wrap.innerHTML = `
    <div class="section-header">
      <div>
        <div class="eyebrow">Administrace</div>
        <h2 class="section-title">Admin panel</h2>
        <p class="section-sub">SprÃ¡va soutÄ›Å¾Ã­, kol a porotcÅ¯</p>
      </div>
    </div>

    <div class="admin-grid">
      <!-- LevÃ½ sloupec: formulÃ¡Å™e -->
      <div class="admin-sidebar">

        <!-- NovÃ¡ soutÄ›Å¾ -->
        <div class="form-card">
          <div class="form-card-title">ğŸ† NovÃ¡ soutÄ›Å¾</div>
          <div id="adminCompMsg"></div>
          <div class="field"><label>NÃ¡zev</label><input type="text" id="aCompName" placeholder="JarnÃ­ taneÄnÃ­ soutÄ›Å¾" class="text-input"></div>
          <div class="field"><label>Datum</label><input type="date" id="aCompDate" class="text-input"></div>
          <button class="btn-primary w100" id="aCompBtn" onclick="adminCreateComp()">VytvoÅ™it soutÄ›Å¾</button>
        </div>

        <!-- NovÃ© kolo -->
        <div class="form-card">
          <div class="form-card-title">ğŸ¯ PÅ™idat kolo</div>
          <div id="adminRoundMsg"></div>
          <div class="field">
            <label>SoutÄ›Å¾</label>
            <select id="aRoundComp" class="select-input"><option value="">NaÄÃ­tÃ¡mâ€¦</option></select>
          </div>
          <div class="field"><label>NÃ¡zev kola</label><input type="text" id="aRoundName" placeholder="Latinsko-americkÃ© â€“ FinÃ¡le" class="text-input"></div>
          <button class="btn-primary w100" id="aRoundBtn" onclick="adminCreateRound()">PÅ™idat kolo</button>
        </div>

        <!-- PÅ™idat porotce -->
        <div class="form-card">
          <div class="form-card-title">â­ PÅ™idat porotce</div>
          <div id="adminJurorMsg"></div>
          <p style="font-size:12px;color:var(--muted);margin-bottom:14px;line-height:1.6">
            Porotce se musÃ­ nejprve pÅ™ihlÃ¡sit pÅ™es sekci Porota. Pak zadejte jeho User UID z Firebase Console.
          </p>
          <div class="field"><label>Firebase UID porotce</label><input type="text" id="aJurorUid" placeholder="uid z Firebase Auth" class="text-input"></div>
          <div class="field"><label>JmÃ©no porotce</label><input type="text" id="aJurorName" placeholder="Jana PorotkovÃ¡" class="text-input"></div>
          <button class="btn-primary w100" id="aJurorBtn" onclick="adminAddJuror()">PÅ™idat porotce</button>
        </div>
      </div>

      <!-- PravÃ½ sloupec: pÅ™ehled -->
      <div id="adminCompList"><p class="loading-text">NaÄÃ­tÃ¡mâ€¦</p></div>
    </div>`;

  await adminRefreshAll();
}

async function adminRefreshAll() {
  await Promise.all([adminLoadComps(), adminLoadRoundCompSelect()]);
}

async function adminLoadComps() {
  const el = document.getElementById('adminCompList');
  if (!el) return;
  try {
    const [compSnap, roundSnap, partSnap] = await Promise.all([
      getDocs(query(collection(db,'competitions'), orderBy('createdAt','desc'))),
      getDocs(collection(db,'rounds')),
      getDocs(collection(db,'participants'))
    ]);

    const roundsByComp = {};
    roundSnap.docs.forEach(d=>{const r=d.data(); (roundsByComp[r.competitionId]??=[]).push({id:d.id,...r});});
    const countByComp  = {};
    partSnap.docs.forEach(d=>{const p=d.data(); countByComp[p.competitionId]=(countByComp[p.competitionId]||0)+1;});

    if (compSnap.empty) { el.innerHTML='<div class="empty-card"><div class="empty-icon">ğŸ†</div><p>ZatÃ­m Å¾Ã¡dnÃ© soutÄ›Å¾e.</p></div>'; return; }

    el.innerHTML = compSnap.docs.map(d=>{
      const c      = d.data();
      const rounds = roundsByComp[d.id] || [];
      const pCount = countByComp[d.id] || 0;
      const badgeCls = c.status==='open'?'badge-open':c.status==='closed'?'badge-closed':'badge-active';
      const badgeTxt = c.status==='open'?'OtevÅ™ena':c.status==='closed'?'UzavÅ™ena':'ProbÃ­hÃ¡';

      const roundRows = rounds.map(r=>{
        const rBadge = r.status==='active'?'badge-active':r.status==='closed'?'badge-closed':'badge-pending';
        const rTxt   = r.status==='active'?'AktivnÃ­':r.status==='closed'?'UzavÅ™eno':'PÅ™ipraveno';
        const startBtn = r.status==='pending'
          ? `<button class="btn-xs btn-go" onclick="adminSetRound('${r.id}','active')">â–¶ Spustit</button>`
          : r.status==='active'
          ? `<button class="btn-xs btn-stop" onclick="adminSetRound('${r.id}','closed')">â¹ UzavÅ™Ã­t</button>`
          : '';
        return `<div class="round-row">
          <div><div class="round-name">${esc(r.name)}</div><div class="round-num">Kolo Ä.${r.roundNumber}</div></div>
          <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
            <span class="badge ${rBadge}">${rTxt}</span>${startBtn}
            <button class="btn-xs btn-results" onclick="adminShowResults('${r.id}','${esc(r.name)}')">ğŸ“Š</button>
          </div>
        </div>`;
      }).join('');

      return `<div class="comp-card">
        <div class="comp-header">
          <div>
            <div class="comp-name">${esc(c.name)}</div>
            <div class="comp-date">${fmtDate(c.date)}</div>
          </div>
          <span class="badge ${badgeCls}">${badgeTxt}</span>
        </div>
        <div class="stats-row">
          <div class="stat-box"><div class="stat-val">${pCount}</div><div class="stat-lbl">ÃšÄastnÃ­ci</div></div>
          <div class="stat-box"><div class="stat-val">${rounds.length}</div><div class="stat-lbl">Kola</div></div>
          <div class="stat-box"><div class="stat-val">${rounds.filter(r=>r.status==='closed').length}</div><div class="stat-lbl">UzavÅ™eno</div></div>
        </div>
        <div class="rounds-title">Kola soutÄ›Å¾e</div>
        ${roundRows || '<p style="font-size:13px;color:var(--muted);font-style:italic;margin-bottom:8px">ZatÃ­m Å¾Ã¡dnÃ¡ kola.</p>'}
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn-outline" onclick="adminShowParticipants('${d.id}','${esc(c.name)}')">ğŸ‘¥ ÃšÄastnÃ­ci</button>
        </div>
      </div>`;
    }).join('');
  } catch(e) { el.innerHTML=`<p class="err-txt">Chyba: ${e.message}</p>`; }
}

async function adminLoadRoundCompSelect() {
  const sel = document.getElementById('aRoundComp');
  if (!sel) return;
  try {
    const snap = await getDocs(query(collection(db,'competitions'), orderBy('createdAt','desc')));
    sel.innerHTML = '<option value="">â€” Vyberte soutÄ›Å¾ â€”</option>' +
      snap.docs.map(d=>`<option value="${d.id}">${esc(d.data().name)}</option>`).join('');
  } catch(e) {}
}

window.adminCreateComp = async function() {
  const name = document.getElementById('aCompName').value.trim();
  const date = document.getElementById('aCompDate').value;
  const msg  = document.getElementById('adminCompMsg');
  const btn  = document.getElementById('aCompBtn');

  clearMsgEl(msg);
  if (!name||!date) { showMsgEl(msg,'error','VyplÅˆte nÃ¡zev a datum.'); return; }

  setBtnLoading('aCompBtn',true,'VytvÃ¡Å™Ã­mâ€¦');
  try {
    await addDoc(collection(db,'competitions'), { name, date, status:'open', createdAt: serverTimestamp() });
    showMsgEl(msg,'success','âœ“ SoutÄ›Å¾ vytvoÅ™ena!');
    document.getElementById('aCompName').value='';
    document.getElementById('aCompDate').value='';
    setTimeout(()=>clearMsgEl(msg),3000);
    await adminRefreshAll();
  } catch(e) { showMsgEl(msg,'error',e.message); }
  setBtnLoading('aCompBtn',false,'VytvoÅ™it soutÄ›Å¾');
}

window.adminCreateRound = async function() {
  const compId = document.getElementById('aRoundComp').value;
  const name   = document.getElementById('aRoundName').value.trim();
  const msg    = document.getElementById('adminRoundMsg');

  clearMsgEl(msg);
  if (!compId||!name) { showMsgEl(msg,'error','Vyberte soutÄ›Å¾ a zadejte nÃ¡zev.'); return; }

  setBtnLoading('aRoundBtn',true,'PÅ™idÃ¡vÃ¡mâ€¦');
  try {
    const snap = await getDocs(query(collection(db,'rounds'), where('competitionId','==',compId)));
    await addDoc(collection(db,'rounds'), {
      competitionId: compId, name,
      roundNumber: snap.size+1,
      status: 'pending',
      createdAt: serverTimestamp()
    });
    showMsgEl(msg,'success','âœ“ Kolo pÅ™idÃ¡no!');
    document.getElementById('aRoundName').value='';
    setTimeout(()=>clearMsgEl(msg),3000);
    await adminLoadComps();
  } catch(e) { showMsgEl(msg,'error',e.message); }
  setBtnLoading('aRoundBtn',false,'PÅ™idat kolo');
}

window.adminAddJuror = async function() {
  const uid  = document.getElementById('aJurorUid').value.trim();
  const name = document.getElementById('aJurorName').value.trim();
  const msg  = document.getElementById('adminJurorMsg');

  clearMsgEl(msg);
  if (!uid||!name) { showMsgEl(msg,'error','VyplÅˆte UID a jmÃ©no.'); return; }

  setBtnLoading('aJurorBtn',true,'UklÃ¡dÃ¡mâ€¦');
  try {
    await setDoc(doc(db,'users',uid), { role:'jury', name, createdAt: serverTimestamp() }, {merge:true});
    showMsgEl(msg,'success','âœ“ Porotce pÅ™idÃ¡n!');
    document.getElementById('aJurorUid').value='';
    document.getElementById('aJurorName').value='';
    setTimeout(()=>clearMsgEl(msg),3000);
  } catch(e) { showMsgEl(msg,'error',e.message); }
  setBtnLoading('aJurorBtn',false,'PÅ™idat porotce');
}

window.adminSetRound = async function(roundId, status) {
  try {
    await updateDoc(doc(db,'rounds',roundId), { status });
    await adminLoadComps();
  } catch(e) { alert('Chyba: '+e.message); }
}

window.adminShowResults = async function(roundId, roundName) {
  const modal = document.getElementById('modal');
  document.getElementById('modalTitle').textContent = roundName;
  document.getElementById('modalBody').innerHTML = '<p class="loading-text">NaÄÃ­tÃ¡m vÃ½sledkyâ€¦</p>';
  modal.classList.add('show');

  try {
    const scoresSnap = await getDocs(query(collection(db,'scores'), where('roundId','==',roundId)));
    const byParticipant = {};
    const participantIds = new Set();

    scoresSnap.docs.forEach(d=>{
      const s = d.data();
      participantIds.add(s.participantId);
      if (!byParticipant[s.participantId]) byParticipant[s.participantId] = {scores:[], jurors:[]};
      byParticipant[s.participantId].scores.push(s.score);
      byParticipant[s.participantId].jurors.push(s.jurorEmail||'?');
    });

    // NaÄteme jmÃ©na ÃºÄastnÃ­kÅ¯
    const partData = {};
    for (const pid of participantIds) {
      const snap = await getDoc(doc(db,'participants',pid));
      if (snap.exists()) partData[pid] = snap.data();
    }

    const results = Object.entries(byParticipant).map(([pid, data])=>{
      const p = partData[pid]||{};
      const avg   = data.scores.reduce((a,b)=>a+b,0)/data.scores.length;
      const total = data.scores.reduce((a,b)=>a+b,0);
      return { name:p.name||'?', number:p.number||0, scores:data.scores, avg, total, cnt:data.scores.length };
    }).sort((a,b)=>b.avg-a.avg);

    if (!results.length) { document.getElementById('modalBody').innerHTML='<p class="empty-txt">ZatÃ­m Å¾Ã¡dnÃ© vÃ½sledky.</p>'; return; }

    let html = `<table class="res-table"><thead><tr><th>MÃ­sto</th><th>ÄŒ.</th><th>JmÃ©no</th><th style="text-align:center">Porotci</th><th>PrÅ¯mÄ›r</th><th>Celkem</th></tr></thead><tbody>`;
    results.forEach((r,i)=>{
      const medal = i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':`#${i+1}`;
      html+=`<tr><td class="rank-cell">${medal}</td><td class="num-cell">#${r.number}</td><td style="color:var(--text)">${esc(r.name)}</td><td style="text-align:center;color:var(--muted)">${r.cnt}</td><td style="color:var(--muted)">${r.avg.toFixed(2)}</td><td style="color:var(--text);font-weight:600">${r.total.toFixed(2)}</td></tr>`;
    });
    html+='</tbody></table>';
    document.getElementById('modalBody').innerHTML = html;
  } catch(e) { document.getElementById('modalBody').innerHTML=`<p class="err-txt">${e.message}</p>`; }
}

window.adminShowParticipants = async function(compId, compName) {
  const modal = document.getElementById('modal');
  document.getElementById('modalTitle').textContent = compName + ' â€“ ÃšÄastnÃ­ci';
  document.getElementById('modalBody').innerHTML = '<p class="loading-text">NaÄÃ­tÃ¡mâ€¦</p>';
  modal.classList.add('show');

  try {
    const snap = await getDocs(query(collection(db,'participants'), where('competitionId','==',compId), orderBy('number')));
    if (snap.empty) { document.getElementById('modalBody').innerHTML='<p class="empty-txt">Å½Ã¡dnÃ­ ÃºÄastnÃ­ci.</p>'; return; }
    let html=`<table class="res-table"><thead><tr><th>ÄŒÃ­slo</th><th>JmÃ©no</th><th>E-mail</th></tr></thead><tbody>`;
    snap.docs.forEach(d=>{
      const p=d.data();
      html+=`<tr><td class="num-cell">#${p.number}</td><td style="color:var(--text)">${esc(p.name)}</td><td style="color:var(--muted);font-size:13px">${esc(p.email)}</td></tr>`;
    });
    html+='</tbody></table>';
    document.getElementById('modalBody').innerHTML = html;
  } catch(e) { document.getElementById('modalBody').innerHTML=`<p class="err-txt">${e.message}</p>`; }
}

// â”€â”€â”€ LOGIN MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.doLogin = async function() {
  const email = document.getElementById('authEmail').value.trim();
  const pass  = document.getElementById('authPass').value;
  const errEl = document.getElementById('authErr');
  const btn   = document.getElementById('authBtn');

  errEl.textContent=''; errEl.style.display='none';
  if (!email||!pass) { errEl.textContent='VyplÅˆte e-mail a heslo.'; errEl.style.display='block'; return; }

  btn.disabled=true; btn.innerHTML='<span class="spinner"></span> PÅ™ihlaÅ¡ujiâ€¦';
  try {
    await signInWithEmailAndPassword(auth, email, pass);
    closeLoginModal();
    const target = pendingPage || currentPage;
    pendingPage = null;
    setTimeout(()=>showPage(target),300);
  } catch(e) {
    errEl.textContent = e.code==='auth/invalid-credential' ? 'Å patnÃ½ e-mail nebo heslo.' : e.message;
    errEl.style.display='block';
  }
  btn.disabled=false; btn.innerHTML='PÅ™ihlÃ¡sit se';
}

window.doLogout = async function() {
  await signOut(auth);
  showPage('home');
}

window.openLoginModal = function(targetPage) { pendingPage = targetPage || null; document.getElementById('loginModal').classList.add('show'); document.getElementById('authEmail').focus(); }
window.closeLoginModal = function() { document.getElementById('loginModal').classList.remove('show'); }
window.closeModal      = function() { document.getElementById('modal').classList.remove('show'); }

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loginPrompt(page) {
  return `<div class="login-prompt">
    <div class="lp-icon">${page==='jury'?'â­':'ğŸ”'}</div>
    <h3 class="lp-title">${page==='jury'?'PÅ™ihlÃ¡Å¡enÃ­ poroty':'Admin pÅ™ihlÃ¡Å¡enÃ­'}</h3>
    <p class="lp-sub">Pro pÅ™Ã­stup k tÃ©to sekci se musÃ­te pÅ™ihlÃ¡sit.</p>
    <button class="btn-primary" onclick="openLoginModal('${page}')">PÅ™ihlÃ¡sit se</button>
  </div>`;
}

function esc(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function fmtDate(d) {
  if (!d) return '';
  return new Date(d+'T00:00:00').toLocaleDateString('cs-CZ',{day:'numeric',month:'long',year:'numeric'});
}
function showMsg(id,type,msg) {
  const el=document.getElementById(id); el.className='msg msg-'+type; el.textContent=msg; el.style.display='block';
}
function clearMsg(id) { const el=document.getElementById(id); el.style.display='none'; el.textContent=''; }
function showMsgEl(el,type,msg) { el.className='msg msg-'+type; el.textContent=msg; el.style.display='block'; }
function clearMsgEl(el) { el.style.display='none'; el.textContent=''; }
function setBtnLoading(id,on,txt) {
  const btn=document.getElementById(id);
  btn.disabled=on;
  btn.innerHTML=on?`<span class="spinner"></span> ${txt}`:txt;
}

// Init
setTimeout(()=>showPage('home'),100);
</script>

<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:       #08090e;
  --card:     #0d0e18;
  --card2:    #111220;
  --border:   #1c1d2e;
  --bhi:      rgba(210,170,80,0.3);
  --gold:     #d2aa50;
  --gold-lt:  #f0cc78;
  --gold-dk:  #9e7c30;
  --crimson:  #8b2020;
  --text:     #ede9df;
  --muted:    rgba(237,233,223,0.42);
  --success:  #4aa870;
  --danger:   #c04848;
  --r:        13px;
  --r-sm:     9px;
}

html { scroll-behavior: smooth; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

/* â”€â”€ AMBIENT â”€â”€ */
body::before {
  content: '';
  position: fixed; top: 0; left: 0; right: 0; height: 400px;
  background: radial-gradient(ellipse 80% 100% at 50% 0%, rgba(139,32,32,0.07) 0%, transparent 70%);
  pointer-events: none; z-index: 0;
}
body::after {
  content: '';
  position: fixed; inset: 0;
  background-image:
    linear-gradient(rgba(255,255,255,0.014) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.014) 1px, transparent 1px);
  background-size: 52px 52px;
  pointer-events: none; z-index: 0;
}

/* â”€â”€ NAV â”€â”€ */
nav {
  position: sticky; top: 0; z-index: 50;
  background: rgba(8,9,14,0.85);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 0 24px;
  display: flex; align-items: center;
  height: 60px; gap: 4px;
}
.nav-logo {
  font-family: 'Playfair Display', serif;
  font-size: 1.3rem; font-weight: 900;
  background: linear-gradient(135deg, var(--gold-lt), var(--gold));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  letter-spacing: -.01em; margin-right: 12px; white-space: nowrap;
}
.nav-btn {
  display: flex; align-items: center; gap: 6px;
  background: none; border: none; color: var(--muted);
  font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 500;
  letter-spacing: .04em; padding: 8px 12px; border-radius: 8px; cursor: pointer;
  transition: color .2s, background .2s; white-space: nowrap;
}
.nav-btn:hover  { color: var(--text); background: rgba(255,255,255,.04); }
.nav-btn.active { color: var(--gold); background: rgba(210,170,80,.08); }
.nav-spacer { flex: 1; }
.nav-user   { font-size: 12px; color: var(--muted); max-width: 160px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

/* â”€â”€ PAGES â”€â”€ */
.page { display: none; min-height: calc(100vh - 60px); }
.page.active { display: block; }

/* â”€â”€ HERO â”€â”€ */
.hero {
  position: relative; z-index: 1;
  text-align: center; padding: 80px 24px 60px;
  max-width: 720px; margin: 0 auto;
}
.hero-eyebrow {
  font-size: 11px; letter-spacing: .3em; text-transform: uppercase;
  color: var(--gold); opacity: .7; margin-bottom: 16px;
}
.hero-title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(3rem, 8vw, 5.5rem); font-weight: 900; line-height: .95;
  background: linear-gradient(160deg, var(--gold-lt) 0%, var(--gold) 45%, var(--gold-dk) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  margin-bottom: 20px;
}
.hero-sub { color: var(--muted); font-size: 16px; line-height: 1.7; max-width: 500px; margin: 0 auto 40px; }

.hero-cards {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 16px; max-width: 620px; margin: 0 auto 60px;
}
.hero-card {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--r);
  padding: 24px 20px; cursor: pointer; transition: border-color .2s, transform .2s, box-shadow .2s;
  position: relative; overflow: hidden;
}
.hero-card::before { content:''; position:absolute; top:0;left:0;right:0; height:1px; background:linear-gradient(90deg,transparent,var(--gold-dk),transparent); }
.hero-card:hover { border-color: var(--bhi); transform: translateY(-3px); box-shadow: 0 12px 40px rgba(0,0,0,.4); }
.hero-card-icon  { font-size: 2rem; margin-bottom: 12px; }
.hero-card-title { font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.hero-card-sub   { font-size: 13px; color: var(--muted); }

.home-comps-title { font-size: 12px; letter-spacing: .15em; text-transform: uppercase; color: var(--muted); margin-bottom: 14px; font-weight: 500; }
.comp-pill {
  display: flex; align-items: center; justify-content: space-between;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--r);
  padding: 16px 20px; cursor: pointer; transition: border-color .2s;
  margin-bottom: 10px; gap: 12px;
}
.comp-pill:hover { border-color: var(--bhi); }
.comp-pill-name  { font-size: 15px; font-weight: 500; color: var(--text); margin-bottom: 3px; }
.comp-pill-date  { font-size: 13px; color: var(--muted); }

/* â”€â”€ CONTENT WRAP â”€â”€ */
.content { max-width: 960px; margin: 0 auto; padding: 40px 24px 60px; position: relative; z-index: 1; }

/* â”€â”€ SECTION HEADER â”€â”€ */
.section-header { margin-bottom: 32px; }
.eyebrow { font-size: 11px; letter-spacing: .25em; text-transform: uppercase; color: var(--gold); opacity: .7; margin-bottom: 10px; }
.section-title { font-family: 'Playfair Display', serif; font-size: clamp(1.8rem,5vw,2.6rem); font-weight: 700; background: linear-gradient(135deg,var(--gold-lt),var(--gold),var(--gold-dk)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom: 6px; }
.section-sub   { font-size: 14px; color: var(--muted); }

/* â”€â”€ REGISTER â”€â”€ */
.reg-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; align-items: start; }
@media(max-width:640px) { .reg-layout { grid-template-columns: 1fr; } }

.form-box { background: var(--card); border: 1px solid var(--border); border-radius: var(--r); padding: 32px; position: relative; overflow: hidden; }
.form-box::before { content:''; position:absolute; top:0;left:0;right:0; height:1px; background:linear-gradient(90deg,transparent,var(--gold-dk),transparent); }

.field { margin-bottom: 18px; }
label { display: block; font-size: 12px; letter-spacing: .08em; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; font-weight: 500; }
.text-input, .select-input {
  width: 100%; background: rgba(255,255,255,.03); border: 1px solid var(--border);
  border-radius: var(--r-sm); color: var(--text); font-family: 'DM Sans', sans-serif;
  font-size: 15px; padding: 12px 15px; outline: none;
  transition: border-color .2s, box-shadow .2s;
}
.select-input {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='none'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23d2aa50' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 14px center; padding-right: 40px;
}
.select-input option { background: #0d0e18; }
.text-input:focus, .select-input:focus { border-color: var(--bhi); box-shadow: 0 0 0 3px rgba(210,170,80,.07); }
.text-input::placeholder { color: rgba(255,255,255,.18); }

/* Buttons */
.btn-primary {
  background: linear-gradient(135deg,var(--gold-dk),var(--gold));
  color: #08090e; font-family: 'DM Sans',sans-serif; font-size: 14px; font-weight: 600;
  letter-spacing: .07em; text-transform: uppercase;
  border: none; border-radius: var(--r-sm); padding: 14px 28px; cursor: pointer;
  transition: opacity .2s, transform .15s; display: inline-flex; align-items: center; gap: 6px;
}
.btn-primary:hover:not(:disabled) { opacity: .88; transform: translateY(-1px); }
.btn-primary:disabled { opacity: .4; cursor: not-allowed; }
.w100 { width: 100%; justify-content: center; }

.btn-outline {
  background: transparent; border: 1px solid var(--bhi); color: var(--gold);
  font-family: 'DM Sans',sans-serif; font-size: 12px; font-weight: 500;
  letter-spacing: .07em; text-transform: uppercase;
  border-radius: var(--r-sm); padding: 10px 18px; cursor: pointer; transition: background .2s;
}
.btn-outline:hover { background: rgba(210,170,80,.08); }

/* Messages */
.msg { padding: 12px 15px; border-radius: var(--r-sm); font-size: 14px; margin-bottom: 16px; display: none; line-height: 1.5; }
.msg-error   { background: rgba(192,72,72,.1); border: 1px solid rgba(192,72,72,.3); color: #e89090; }
.msg-success { background: rgba(74,168,112,.1); border: 1px solid rgba(74,168,112,.3); color: #8dd8a8; }

/* Register success */
#regSuccess {
  display: none; flex-direction: column; align-items: center; text-align: center;
  padding: 20px 0; gap: 20px;
}
.success-ring {
  width: 150px; height: 150px; border-radius: 50%;
  border: 2px solid var(--gold); background: rgba(210,170,80,.06);
  display: flex; align-items: center; justify-content: center;
  animation: pulse 2.5s ease-in-out infinite;
}
@keyframes pulse {
  0%,100% { box-shadow: 0 0 30px rgba(210,170,80,.15); }
  50%      { box-shadow: 0 0 60px rgba(210,170,80,.4); }
}
.success-num {
  font-family: 'Playfair Display', serif; font-size: 72px; font-weight: 900; line-height: 1;
  background: linear-gradient(135deg,var(--gold-lt),var(--gold)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}
.success-name { font-family: 'Playfair Display', serif; font-size: 1.5rem; font-weight: 700; color: var(--text); }
.success-hint { font-size: 13px; color: var(--muted); line-height: 1.6; }
.success-btns { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; }

/* Info card */
.info-card {
  background: rgba(139,32,32,.06); border: 1px solid rgba(139,32,32,.2);
  border-radius: var(--r); padding: 24px;
}
.info-card h3 { font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 12px; }
.info-card p  { font-size: 13px; color: var(--muted); line-height: 1.8; }
.info-card ul { padding-left: 18px; color: var(--muted); font-size: 13px; line-height: 2; }

/* Badges */
.badge { display: inline-flex; align-items: center; font-size: 11px; font-weight: 500; padding: 4px 10px; border-radius: 999px; letter-spacing: .06em; text-transform: uppercase; border: 1px solid; }
.badge-open    { color: #7dd3a8; border-color: rgba(74,168,112,.35); background: rgba(74,168,112,.1); }
.badge-active  { color: var(--gold-lt); border-color: rgba(210,170,80,.35); background: rgba(210,170,80,.08); }
.badge-closed  { color: rgba(237,233,223,.28); border-color: rgba(255,255,255,.1); background: rgba(255,255,255,.03); }
.badge-pending { color: rgba(237,233,223,.35); border-color: rgba(255,255,255,.1); background: rgba(255,255,255,.03); }

/* â”€â”€ JURY â”€â”€ */
#juryWrap { min-height: 60vh; }

.notice-locked { background: rgba(192,72,72,.08); border: 1px solid rgba(192,72,72,.25); border-radius: var(--r-sm); padding: 12px 16px; color: #e89090; font-size: 13px; margin-bottom: 20px; }

.progress-card { background: var(--card); border: 1px solid var(--border); border-radius: var(--r); padding: 20px 24px; margin-bottom: 20px; }
.progress-top  { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.progress-label { font-size: 13px; color: var(--muted); }
.progress-val   { font-size: 13px; color: var(--gold); font-weight: 600; }
.progress-track { height: 4px; background: rgba(255,255,255,.06); border-radius: 999px; overflow: hidden; }
.progress-fill  { height: 100%; background: linear-gradient(90deg,var(--gold-dk),var(--gold-lt)); border-radius: 999px; transition: width .5s ease; }

.table-card { background: var(--card); border: 1px solid var(--border); border-radius: var(--r); overflow: hidden; }
table { width: 100%; border-collapse: collapse; }
thead tr { border-bottom: 1px solid var(--border); }
th { font-size: 11px; letter-spacing: .1em; text-transform: uppercase; color: var(--muted); font-weight: 500; padding: 13px 16px; text-align: left; }
tbody tr { border-bottom: 1px solid rgba(255,255,255,.04); transition: background .15s; }
tbody tr:last-child { border-bottom: none; }
tbody tr:hover { background: rgba(255,255,255,.02); }
tbody tr.row-saved { background: rgba(210,170,80,.03); }
td { padding: 13px 16px; font-size: 14px; color: var(--muted); vertical-align: middle; }
.td-name { font-size: 15px; color: var(--text); font-weight: 500; }

.num-circle {
  width: 38px; height: 38px; border-radius: 50%;
  border: 1px solid rgba(210,170,80,.3);
  display: inline-flex; align-items: center; justify-content: center;
  font-family: 'Playfair Display', serif; font-size: 1.1rem; font-weight: 700; color: var(--gold);
}

.dots-row  { display: flex; gap: 5px; justify-content: center; align-items: center; }
.dot       { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,.1); transition: background .3s; }
.dot-filled { background: var(--gold); }

.score-input {
  width: 86px; background: rgba(255,255,255,.04); border: 1px solid var(--border);
  border-radius: 8px; color: var(--text); font-family: 'DM Sans',sans-serif; font-size: 16px;
  font-weight: 500; padding: 9px 10px; outline: none; text-align: center;
  transition: border-color .2s, box-shadow .2s;
  -moz-appearance: textfield;
}
.score-input::-webkit-inner-spin-button { -webkit-appearance: none; }
.score-input:focus  { border-color: var(--bhi); box-shadow: 0 0 0 3px rgba(210,170,80,.07); }
.score-input.input-saved  { border-color: rgba(74,168,112,.5); }
.score-input.input-error  { border-color: rgba(192,72,72,.6); }

.btn-save {
  background: transparent; border: 1px solid var(--bhi); color: var(--gold);
  font-family: 'DM Sans',sans-serif; font-size: 12px; font-weight: 500;
  letter-spacing: .06em; text-transform: uppercase;
  border-radius: 8px; padding: 9px 14px; cursor: pointer;
  transition: background .2s; white-space: nowrap;
  display: inline-flex; align-items: center; gap: 5px;
}
.btn-save:hover:not(:disabled) { background: rgba(210,170,80,.1); }
.btn-save:disabled { opacity: .3; cursor: not-allowed; }
.btn-save.btn-saved { color: var(--success); border-color: rgba(74,168,112,.4); }

.save-all-wrap { display: flex; justify-content: flex-end; margin-top: 16px; }

/* â”€â”€ ADMIN â”€â”€ */
.admin-grid { display: grid; grid-template-columns: 320px 1fr; gap: 24px; align-items: start; }
@media(max-width:780px) { .admin-grid { grid-template-columns: 1fr; } }
.admin-sidebar { display: flex; flex-direction: column; gap: 16px; }

.form-card { background: var(--card); border: 1px solid var(--border); border-radius: var(--r); padding: 24px; position: relative; overflow: hidden; }
.form-card::before { content:''; position:absolute; top:0;left:0;right:0; height:1px; background:linear-gradient(90deg,transparent,var(--gold-dk),transparent); }
.form-card-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 16px; }

.comp-card { background: var(--card); border: 1px solid var(--border); border-radius: var(--r); padding: 24px; margin-bottom: 18px; position: relative; overflow: hidden; }
.comp-card::before { content:''; position:absolute; top:0;left:0;right:0; height:1px; background:linear-gradient(90deg,transparent,var(--gold-dk),transparent); }
.comp-header { display: flex; align-items: flex-start; justify-content: space-between; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
.comp-name   { font-family: 'Playfair Display', serif; font-size: 1.3rem; font-weight: 700; color: var(--text); margin-bottom: 3px; }
.comp-date   { font-size: 13px; color: var(--muted); }

.stats-row { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; }
.stat-box  { background: rgba(255,255,255,.025); border: 1px solid var(--border); border-radius: 10px; padding: 11px 15px; flex: 1; min-width: 70px; text-align: center; }
.stat-val  { font-family: 'Playfair Display', serif; font-size: 1.6rem; font-weight: 700; color: var(--gold); line-height: 1; }
.stat-lbl  { font-size: 11px; color: var(--muted); margin-top: 3px; text-transform: uppercase; letter-spacing: .06em; }

.rounds-title { font-size: 11px; letter-spacing: .12em; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; font-weight: 500; }
.round-row    { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,.025); border: 1px solid var(--border); border-radius: 9px; padding: 11px 15px; margin-bottom: 7px; gap: 8px; flex-wrap: wrap; }
.round-name   { font-size: 14px; color: var(--text); font-weight: 500; }
.round-num    { font-size: 12px; color: var(--muted); margin-top: 2px; }

.btn-xs { font-family: 'DM Sans',sans-serif; font-size: 11px; font-weight: 600; letter-spacing: .06em; text-transform: uppercase; border: none; border-radius: 7px; padding: 7px 13px; cursor: pointer; transition: opacity .2s; white-space: nowrap; }
.btn-go   { background: rgba(74,168,112,.15); border: 1px solid rgba(74,168,112,.35); color: #7dd3a8; }
.btn-go:hover { background: rgba(74,168,112,.25); }
.btn-stop { background: rgba(192,72,72,.12); border: 1px solid rgba(192,72,72,.35); color: #e89090; }
.btn-stop:hover { background: rgba(192,72,72,.22); }
.btn-results { background: rgba(210,170,80,.08); border: 1px solid rgba(210,170,80,.2); color: var(--gold); }
.btn-results:hover { background: rgba(210,170,80,.16); }

.empty-card { text-align: center; padding: 50px 20px; background: var(--card); border: 1px solid var(--border); border-radius: var(--r); }
.empty-icon { font-size: 2.5rem; margin-bottom: 12px; opacity: .5; }

/* â”€â”€ LOGIN PROMPT â”€â”€ */
.login-prompt { text-align: center; padding: 80px 24px; }
.lp-icon  { font-size: 3rem; margin-bottom: 16px; opacity: .6; }
.lp-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 700; color: var(--text); margin-bottom: 10px; }
.lp-sub   { color: var(--muted); font-size: 14px; margin-bottom: 24px; line-height: 1.7; }

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay {
  position: fixed; inset: 0; z-index: 200;
  background: rgba(0,0,0,.75); backdrop-filter: blur(6px);
  display: none; align-items: center; justify-content: center; padding: 24px;
}
.modal-overlay.show { display: flex; animation: fadeIn .2s ease; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
.modal-box {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--r);
  width: 100%; max-width: 600px; max-height: 85vh; overflow-y: auto; padding: 32px;
  position: relative;
}
.modal-close { position: absolute; top: 16px; right: 16px; background: transparent; border: none; color: var(--muted); font-size: 20px; cursor: pointer; line-height: 1; transition: color .2s; }
.modal-close:hover { color: var(--text); }
.modal-title { font-family: 'Playfair Display', serif; font-size: 1.6rem; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.modal-sub   { font-size: 13px; color: var(--muted); margin-bottom: 24px; }

/* Login modal */
.login-modal-box { max-width: 400px; }
.lm-title { font-family: 'Playfair Display', serif; font-size: 1.6rem; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.lm-sub   { font-size: 13px; color: var(--muted); margin-bottom: 24px; }
#authErr  { background: rgba(192,72,72,.1); border: 1px solid rgba(192,72,72,.3); color: #e89090; padding: 10px 14px; border-radius: 8px; font-size: 13px; margin-bottom: 14px; display: none; }

/* Results table */
.res-table { width: 100%; border-collapse: collapse; }
.res-table thead tr { border-bottom: 1px solid var(--border); }
.res-table th { font-size: 11px; letter-spacing: .1em; text-transform: uppercase; color: var(--muted); font-weight: 500; padding: 10px 12px; text-align: left; }
.res-table tbody tr { border-bottom: 1px solid rgba(255,255,255,.04); }
.res-table tbody tr:last-child { border-bottom: none; }
.res-table td { padding: 12px; font-size: 14px; color: var(--muted); }
.rank-cell { font-family: 'Playfair Display', serif; font-size: 1.3rem; }
.num-cell  { color: var(--gold); font-weight: 700; }

/* Misc */
.loading-text { color: var(--muted); font-size: 14px; padding: 20px 0; }
.empty-txt    { color: var(--muted); font-size: 14px; font-style: italic; padding: 20px 0; }
.err-txt      { color: #e89090; font-size: 14px; padding: 16px; background: rgba(192,72,72,.08); border: 1px solid rgba(192,72,72,.25); border-radius: 9px; }

@keyframes spin { to{transform:rotate(360deg)} }
.spinner { width: 14px; height: 14px; border: 2px solid rgba(8,9,14,.35); border-top-color: currentColor; border-radius: 50%; animation: spin .7s linear infinite; display: inline-block; vertical-align: middle; }

@media print {
  nav, .hero-cards, #regForm { display: none !important; }
  #regSuccess { display: flex !important; }
  body { background: white; color: black; }
  .success-ring { border-color: #333; }
  .success-num { color: #333; -webkit-text-fill-color: #333; }
}

@media(max-width:480px) {
  .hero { padding: 48px 16px 40px; }
  .content { padding: 24px 16px 40px; }
  nav { padding: 0 16px; gap: 2px; }
  .nav-btn { padding: 8px 8px; font-size: 12px; }
  th, td { padding: 10px 10px; }
}
</style>
</head>
<body>

<!-- â”€â”€ NAVIGATION â”€â”€ -->
<nav>
  <span class="nav-logo">DanceComp</span>

  <button class="nav-btn active" id="nav-home"     onclick="showPage('home')">ğŸ  DomÅ¯</button>
  <button class="nav-btn"        id="nav-register" onclick="showPage('register')">ğŸ’ƒ Registrace</button>
  <button class="nav-btn"        id="nav-jury"     style="display:none" onclick="showPage('jury')">â­ Porota</button>
  <button class="nav-btn"        id="nav-admin"    style="display:none" onclick="showPage('admin')">ğŸ”§ Admin</button>

  <div class="nav-spacer"></div>

  <div id="navLogin" style="display:flex;align-items:center;gap:8px">
    <button class="nav-btn" onclick="openLoginModal()">PÅ™ihlÃ¡sit se</button>
  </div>
  <div id="navLogout" style="display:none;align-items:center;gap:10px">
    <span class="nav-user" id="userLabel"></span>
    <button class="nav-btn" onclick="doLogout()">OdhlÃ¡sit</button>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-home">
  <div class="hero">
    <p class="hero-eyebrow">TaneÄnÃ­ soutÄ›Å¾nÃ­ systÃ©m</p>
    <h1 class="hero-title">Dance<br>Comp</h1>
    <p class="hero-sub">ProfesionÃ¡lnÃ­ systÃ©m pro sprÃ¡vu taneÄnÃ­ch soutÄ›Å¾Ã­. Registrace, hodnocenÃ­ a vÃ½sledky v reÃ¡lnÃ©m Äase.</p>

    <div class="hero-cards">
      <div class="hero-card" onclick="showPage('register')">
        <div class="hero-card-icon">ğŸ’ƒ</div>
        <div class="hero-card-title">Registrace</div>
        <div class="hero-card-sub">PÅ™ihlaÅ¡te se do soutÄ›Å¾e</div>
      </div>
      <div class="hero-card" onclick="openLoginModal()">
        <div class="hero-card-icon">â­</div>
        <div class="hero-card-title">Porota</div>
        <div class="hero-card-sub">HodnocenÃ­ vystoupenÃ­</div>
      </div>
      <div class="hero-card" onclick="openLoginModal()">
        <div class="hero-card-icon">ğŸ†</div>
        <div class="hero-card-title">Admin</div>
        <div class="hero-card-sub">SprÃ¡va soutÄ›Å¾e</div>
      </div>
    </div>

    <p class="home-comps-title">OtevÅ™enÃ© soutÄ›Å¾e</p>
    <div id="homeComps"><p class="loading-text">NaÄÃ­tÃ¡mâ€¦</p></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REGISTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-register">
  <div class="content">
    <div class="section-header">
      <div class="eyebrow">TaneÄnÃ­ soutÄ›Å¾</div>
      <h2 class="section-title">Registrace taneÄnÃ­ka</h2>
      <p class="section-sub">VyplÅˆte Ãºdaje â€“ soutÄ›Å¾nÃ­ ÄÃ­slo obdrÅ¾Ã­te ihned.</p>
    </div>

    <div class="reg-layout">
      <!-- FormulÃ¡Å™ -->
      <div class="form-box">
        <div id="regForm">
          <div id="regMsg" class="msg"></div>

          <div class="field">
            <label for="regCompSel">SoutÄ›Å¾</label>
            <select id="regCompSel" class="select-input">
              <option value="">NaÄÃ­tÃ¡mâ€¦</option>
            </select>
          </div>
          <div class="field">
            <label for="regName">CelÃ© jmÃ©no</label>
            <input type="text" id="regName" class="text-input" placeholder="Jana NovÃ¡kovÃ¡" autocomplete="name">
          </div>
          <div class="field">
            <label for="regEmail">E-mailovÃ¡ adresa</label>
            <input type="email" id="regEmail" class="text-input" placeholder="jana@example.com" autocomplete="email"
              onkeydown="if(event.key==='Enter') doRegister()">
          </div>
          <button class="btn-primary w100" id="regBtn" onclick="doRegister()">Zaregistrovat se</button>
          <p style="text-align:center;font-size:12px;color:var(--muted);margin-top:14px">RegistracÃ­ souhlasÃ­te s pravidly soutÄ›Å¾e.</p>
        </div>

        <!-- ÃšspÄ›ch -->
        <div id="regSuccess">
          <p style="font-size:11px;letter-spacing:.25em;text-transform:uppercase;color:var(--gold);opacity:.7">Registrace ÃºspÄ›Å¡nÃ¡</p>
          <p style="font-size:13px;color:var(--muted)">VaÅ¡e soutÄ›Å¾nÃ­ ÄÃ­slo</p>
          <div class="success-ring">
            <span class="success-num" id="regSuccessNum">â€”</span>
          </div>
          <p class="success-name" id="regSuccessName"></p>
          <p class="success-hint">Zapamatujte si toto ÄÃ­slo nebo si strÃ¡nku vytisknÄ›te.</p>
          <div class="success-btns">
            <button class="btn-outline" onclick="window.print()">ğŸ–¨ Vytisknout</button>
            <button class="btn-outline" onclick="regReset()">â† DalÅ¡Ã­ registrace</button>
          </div>
        </div>
      </div>

      <!-- Info box -->
      <div class="info-card">
        <h3>â„¹ Jak to funguje</h3>
        <p>Po odeslÃ¡nÃ­ formulÃ¡Å™e systÃ©m:</p>
        <ul>
          <li>OvÄ›Å™Ã­ unikÃ¡tnost vaÅ¡eho emailu</li>
          <li>Atomicky pÅ™iÅ™adÃ­ ÄÃ­slo bez kolizÃ­</li>
          <li>ZobrazÃ­ vaÅ¡e soutÄ›Å¾nÃ­ ÄÃ­slo</li>
        </ul>
        <br>
        <p>SoutÄ›Å¾nÃ­ ÄÃ­slo si zapamatujte nebo vytisknÄ›te â€“ budete ho potÅ™ebovat u vstupu na soutÄ›Å¾.</p>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• JURY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-jury">
  <div class="content">
    <div id="juryWrap"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ADMIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-admin">
  <div class="content">
    <div id="adminWrap"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOGIN MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="loginModal" onclick="if(event.target===this) closeLoginModal()">
  <div class="modal-box login-modal-box">
    <button class="modal-close" onclick="closeLoginModal()">âœ•</button>
    <p class="lm-title">PÅ™ihlÃ¡Å¡enÃ­</p>
    <p class="lm-sub">Pro porotce a administrÃ¡tory soutÄ›Å¾e.</p>

    <div id="authErr"></div>

    <div class="field">
      <label for="authEmail">E-mail</label>
      <input type="email" id="authEmail" class="text-input" placeholder="email@example.com" autocomplete="email">
    </div>
    <div class="field">
      <label for="authPass">Heslo</label>
      <input type="password" id="authPass" class="text-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password"
        onkeydown="if(event.key==='Enter') doLogin()">
    </div>
    <button class="btn-primary w100" id="authBtn" onclick="doLogin()">PÅ™ihlÃ¡sit se</button>

    <p style="font-size:12px;color:var(--muted);margin-top:16px;text-align:center;line-height:1.6">
      ÃšÄty vytvÃ¡Å™ejÃ­ administrÃ¡toÅ™i v Firebase Console.<br>
      TaneÄnÃ­ci se pÅ™ihlaÅ¡ovat nemusÃ­.
    </p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• VÃSLEDKY MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modal" onclick="if(event.target===this) closeModal()">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal()">âœ•</button>
    <p class="modal-title" id="modalTitle">VÃ½sledky</p>
    <p class="modal-sub" id="modalSub">VÃ½sledky kola</p>
    <div id="modalBody"></div>
  </div>
</div>

</body>
</html>
